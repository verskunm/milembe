var attach=function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function h(e,t,n){return(h=d()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&l(i,n.prototype),i}).apply(null,arguments)}function f(e){var t="function"==typeof Map?new Map:void 0;return(f=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return h(e,arguments,u(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),l(r,e)})(e)}function v(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function g(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var y=function(e,n,r,i,o,a){var s=new XMLHttpRequest;return s.open(e,n,!0),Object.keys(i).forEach((function(e){s.setRequestHeader(e,i[e])})),s.withCredentials=o,s.upload&&s.upload.addEventListener("progress",a),s.send(function(e,n){return["POST","PUT","PATCH"].includes(e)?"object"!==t(n)||n instanceof Blob||n instanceof FormData?n:JSON.stringify(n):null}(e,r)),s},b=function(e){return e>=200&&e<=204},k=function(e,t,n,r){var i,o=e.status,a=e.responseText,s=t(o),c={};try{c=JSON.parse(a)}catch(e){c=a}s?n({status:o,data:c,headers:(i=e.getAllResponseHeaders(),i.split("\n").reduce((function(e,t){var n=t.indexOf(":"),r=t.substr(0,n).trim().toLowerCase(),i=t.substr(n+1).trim();return r&&(e[r]=e[r]?"".concat(e[r],", ").concat(i):i),e}),{}))}):r({status:o,data:c,message:"Request failed with status code ".concat(o)})},w=function(){var e=null,t=function(t,n,r,i){var o=i.headers,a=void 0===o?{}:o,s=i.validateStatus,c=void 0===s?b:s,u=i.withCredentials,l=void 0!==u&&u,d=i.cancelLast,h=void 0!==d&&d,f=i.onUploadProgress,v=void 0===f?function(){}:f;h&&null!==e&&e.abort();var m=y(t,n,r,a,l,v);return e=m,function(e,t){return new Promise((function(n,r){e.readyState===XMLHttpRequest.DONE?k(e,t,n,r):e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(k(e,t,n,r),e.onreadystatechange=null)}}))}(m,c)};return{request:t,get:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t("GET",e,{},n)},post:function(e,n,r){return t("POST",e,n,r)},put:function(e,n,r){return t("PUT",e,n,r)},patch:function(e,n,r){return t("PATCH",e,n,r)},delete:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t("DELETE",e,{},n)}}};var x=Object.assign;function E(e){return"object"===t(e)&&null!==e}function C(e){return Array.isArray(e)}function P(e){return void 0===e}function S(e){return"function"==typeof e}function A(e){return null===e||"object"!==t(e)||0===Object.keys(e).length}function T(e,t){return Array.from(e,t)}function O(e,t,n){return T(e.querySelectorAll(t),n)}function N(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return x.apply(void 0,[e.createElement(t)].concat(r))}function R(e,t){return e.parentNode.insertBefore(t,e.nextSibling)}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.includes("/metrum/")}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.split("/metrum/")[1].split("/")[0]}function V(){}function j(e,t,n){var r;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var s=this,c=function(){r=null,n||e.apply(s,o)},u=n&&!r;return clearTimeout(r),r=setTimeout(c,t),u&&e.apply(s,o),r}}function W(e,t){return e.concat(t)}function L(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];if(0===i.length)return e=n;var a=i,s=a.shift();return(e="object"!==t(e)?{}:e)[s]=L.apply(void 0,[e[s],n].concat(a)),e}var B=/Version\/[\d.]+.*Safari/,U=/iPhone|iPad|iPod|Android/i;var D=function(e){return function(t,n){return s({},t,{},e(n))}};var H=function(e,t,n){return e.addEventListener(t,n)},q=function(){return(new Date).getTime()};function _(e){return'<link type="text/css" rel="stylesheet" crossorigin="" href="'.concat(e,'"/>')}var z=function(e){return e.opbox||{}},F=function(e,t){e.opbox=e.opbox||{},x(e.opbox,t)},J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.targetWindow;n(this,e),this.targetWindow=r}return i(e,[{key:"document",get:function(){return this.targetWindow.document}}]),e}();var X=function(e){c(r,e);var t=function(e){function t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}return function(){var n,r=u(e);if(t()){var i=u(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v(this,n)}}(r);function r(e){var i;return n(this,r),(i=t.call(this,e)).message=e,i.name="PageRenderingError",i}return r}(f(Error)),Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.data,i=t.headers;n(this,e),this.data=r,this.headers=i}return i(e,[{key:"valid",get:function(){return E(this.data)}}]),e}();var G=["OK","DATA_SOURCE_ERRORS"],K=function(e){c(r,e);var t=function(e){function t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}return function(){var n,r=u(e);if(t()){var i=u(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v(this,n)}}(r);function r(){return n(this,r),t.apply(this,arguments)}return i(r,[{key:"valid",get:function(){return m(u(r.prototype),"valid",this)&&E(this.headers)&&E(this.renderingResult)&&G.indexOf(this.renderingStatus)>=0}},{key:"renderingResult",get:function(){return this.data.pageRenderingResult}},{key:"renderingStatus",get:function(){return this.data.renderingStatus}},{key:"renderingContext",get:function(){return JSON.parse(this.headers["page-context"])}}]),r}(Y),$=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this.dataSources=t}return i(e,[{key:"resolve",value:function(e,t){var n=e.value;if("DATA_SOURCE"===e.type){var r=this.dataSources[n];return s({},r&&r.data&&o({},t,r.data),{},r&&!A(r.metadata)&&o({},"".concat(t,".$meta"),r.metadata))}return o({},t,n)}}]),e}(),Q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,e);var i=t.boxes,o=void 0===i?[]:i,a=t.dataSources,s=void 0===a?[]:a,c=t.parameters,u=void 0===c?[]:c,l=t.locale,d=t.pageUrl,h=t.canonicalUrl,f=r.edgeHost,v=r.env,m=r.isDirect,p=r.renderDateTime;this.boxes=o,this.dataSources=s,this.context={locale:l,pageUrl:d,canonicalUrl:h,edgeHost:f,env:v,isDirect:m,renderDateTime:p},this.parameters=u,this.parameterResolver=new $(this.resolvedDataSources)}return i(e,[{key:"resolvedDataSources",get:function(){return this.dataSources.reduce((function(e,t){return x(e,o({},t.name,t))}),{})}},{key:"resolvedMeta",get:function(){var e=this;return s({},Object.keys(this.context).reduce((function(t,n){return x(t,o({},"$page.".concat(n),e.context[n]))}),{}),{},this.parameters.reduce((function(t,n){return x(t,e.parameterResolver.resolve(n,n.name))}),{}))}},{key:"resolved",get:function(){return{boxes:this.boxes,dataSources:this.resolvedDataSources,meta:this.resolvedMeta}}}]),e}(),Z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.boxes,i=void 0===r?{}:r,o=t.boxNameToIdMap,a=void 0===o?{}:o,s=t.dataSources,c=void 0===s?{}:s,u=t.meta,l=void 0===u?{}:u;n(this,e),this.boxes=i,this.boxNameToIdMap=a,this.dataSources=c,this.meta=l,this.parameterResolver=new $(this.dataSources)}return i(e,[{key:"resolved",get:function(){return{boxes:this.resolvedBoxes,boxNameToIdMap:this.boxNameToIdMap,dataSources:this.dataSources,meta:this.meta}}},{key:"resolvedBoxes",get:function(){var e=this;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r={};return Object.keys(e).forEach((function(i){r[i]=t.call(n,e[i],i,e)})),r}(this.boxes,(function(t){var n=Object.keys(t).reduce((function(n,r){var i=e.parameterResolver.resolve(t[r],r);return x(n,i)}),{});return x(n,e.pageProperties)}))}},{key:"pageProperties",get:function(){var e=this;return Object.keys(this.meta).filter((function(e){return 0===e.indexOf("$page.")})).reduce((function(t,n){return x(t,o({},n,e.meta[n]))}),{})}}]),e}(),ee=function(e,t){return n=s({},(r=e.search,i={},new URLSearchParams(r).forEach((function(e,t){i[t]=e})),i),{},t),new URLSearchParams(n).toString();var n,r,i};function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new URL(e.href);return n.search=ee(n,t),n.toString()}function ne(e){return e>=200&&e<300||502===e}var re=function(){function e(t){var r=t.httpClient,i=t.reportError,o=t.targetWindow,a=void 0===o?window:o,s=t.subtreeRenderCallback;n(this,e),this.httpClient=r,this.reportError=i,this.targetWindow=a,this.subtreeRenderCallback=s}return i(e,[{key:"getPageData",value:function(e){var t={headers:{Accept:"application/vnd.opbox-web.v2+json"},cancelLast:!0,validateStatus:ne};return this.httpClient.get(e,t).then((function(e){var t=new Y(e);if(!t.valid)throw new X("Opbox response is invalid.");return new Z(t.data)}))}},{key:"getPageRenderingResult",value:function(e){var t={headers:{Accept:"application/vnd.opbox-web.v3+json"},cancelLast:!0,validateStatus:ne};return this.httpClient.get(e,t).then((function(e){return function(e){var t=new K(e);if(!t.valid)throw new X("Page rendering response is invalid.");var n=t.renderingResult,r=t.renderingContext;return new Q(n,r)}(e)}))}},{key:"renderSubtree",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.boxId,r=t.additionalQueryParameters,i=void 0===r?{}:r;if(!n){var o="Missing 'boxId' property!";return this.reportError(new Error(o)),Promise.reject(o)}return this.httpClient.get(te(this.targetWindow.location,i),{headers:{Accept:"application/vnd.opbox-web.subtree+json","x-box-id":n},cancelLast:!1,validateStatus:ne}).then((function(t){var r=t.data;return e.subtreeRenderCallback({boxId:n,data:r})}))}},{key:"createAPI",value:function(){return{getData:this.getPageData.bind(this),renderSubtree:this.renderSubtree.bind(this)}}}]),e}(),ie=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.meta,i=void 0===r?{}:r,o=arguments.length>1?arguments[1]:void 0;n(this,e),this.appContext=o,this.meta=i}return i(e,[{key:"updateMetaRobots",value:function(){var e=this.appContext.document.querySelector('head meta[name="robots"]');e&&this.meta&&e.setAttribute("content",[this.meta.noindexCondition?"noindex":"index",this.meta.nofollowCondition?"nofollow":"follow"].join(", "))}},{key:"render",value:function(){this.updateMetaRobots()}}]),e}(),oe=function(){function e(t){var r=t.appContext,i=t.analytics,o=t.updateComponentCallback,a=void 0===o?V:o,s=t.beforeUpdateComponentCallback,c=void 0===s?V:s;n(this,e),this.appContext=r,this.rawData=new Z,this.listeners={},this.analytics=i,this.updateComponentCallback=a,this.beforeUpdateComponentCallback=c}return i(e,[{key:"registerListener",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:V;if(this.rawData.boxes[e]){var r=this.rawData.resolved.boxes[e];setTimeout((function(){t(r)}),0)}this.listeners[e]={onChange:t,onProgress:n}}},{key:"triggerChangeListener",value:function(e){var t=this;this.rawData=e;var n=this.rawData.resolved,r=n.boxes,i=n.boxNameToIdMap,o=n.meta;Object.entries(r).forEach((function(e){var n=p(e,2),r=n[0],i=n[1];P(i)||t.updateComponentCallback(r,i)})),Object.keys(i).forEach((function(e){var n=r[i[e]];if(!P(n)){var o=t.listeners[e];o&&S(o.onChange)&&setTimeout((function(){return o.onChange(n)}),0)}}));var a=o.defaultCustomParams;this.analytics&&this.analytics.updateCustomParams(a),new ie({meta:o},this.appContext).render()}},{key:"triggerProgressListener",value:function(){var e=this;this.beforeUpdateComponentCallback(),Object.keys(this.listeners).forEach((function(t){var n=e.listeners[t];n&&S(n.onProgress)&&setTimeout((function(){return n.onProgress()}),0)}))}}]),e}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var ae=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){e.exports=function(){function e(e){return e instanceof Object&&e.constructor===Object}function t(n,r){var i=n,o=r;e(n)||(i={}),e(r)||(o={});var a=Object.keys(i),s=Object.keys(o),c={};return a.forEach((function(n){-1!==s.indexOf(n)?null===i[n]?c[n]=o[n]:e(i[n])&&e(o[n])?c[n]=t(i[n],o[n]):c[n]=o[n]:c[n]=i[n]})),s.forEach((function(e){-1===a.indexOf(e)&&(c[e]=o[e])})),c}return function(n){var r=n;e(n)||(r={});for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return o.forEach((function(n){e(n)&&(r=t(r,n))})),r}}()})),se=function(e){return O(e,"[".concat("data-analytics-enabled","]"))},ce=function(e){var t=O(e,"[".concat("data-analytics-proxied","]")).reduce((function(e,t){var n=se(t).filter((function(t){return!e.includes(t)}));return n.length?W(e,n):e}),[]);return se(e).filter((function(e){return!t.includes(e)}))},ue=function(e,t,n,r){return e>0?e<n?t<n?t-e:n-e:0:t<0?0:t<n?t:r},le=function(e){return{width:e.innerWidth,height:e.innerHeight}},de=function(){function e(t){var r,i,o,a,s=t.targetWindow,c=t.boxes,u=void 0===c?[]:c,l=t.significantElementSizePercentage,d=void 0===l?.75:l,h=t.timeoutValue,f=void 0===h?500:h,v=t.debounceTimeoutValue,m=void 0===v?20:v;n(this,e),this.targetWindow=s,this.config={timeoutValue:f,debounceTimeoutValue:m,significantElementSizePercentage:d},this.resetState(),this.boxes=u.length?u:ce(s.document),this.visibleElements=[],this.scrollHandlerWithContext=this.scrollHandler.bind(this),this.scrollEndHandler=j(this.resetCurrentlyVisibleElementsAfterScroll,this.config.debounceTimeoutValue),this.resizeEndHandler=j(this.resizeHandler.bind(this),this.config.debounceTimeoutValue),this.resetCurrentlyVisibleElementsOnTimeout=(r=this.resetCurrentlyVisibleElements.bind(this),i=this.config.debounceTimeoutValue,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=this;return new Promise((function(e){var n=o&&!a;clearTimeout(a),a=setTimeout((function(){a=null,o||e(r.apply(s,t))}),i),n&&e(r.apply(s,t))}))}),this.markCurrentlyVisibleElementsAsSeenOnTimeout=j(this.markCurrentlyVisibleElementsAsSeen.bind(this),this.config.timeoutValue)}return i(e,[{key:"setUserViewport",value:function(){this.state.userViewport=le(this.targetWindow)}},{key:"resetState",value:function(){var e=(new Date).getTime();this.state={isScrolling:!1,scrollStartTime:e,counterStartTime:e,userViewport:le(this.targetWindow)}}},{key:"createEvent",value:function(e){var t;try{(t=this.targetWindow.document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,{})}catch(n){t=new CustomEvent(e,{cancelable:!0,bubbles:!0})}return t}},{key:"isSignificantPartOfElementVisible",value:function(e){var t=e.right-e.left,n=e.bottom-e.top,r=ue(e.left,e.right,this.state.userViewport.width,t);return ue(e.top,e.bottom,this.state.userViewport.height,n)*r/(t*n)>this.config.significantElementSizePercentage}},{key:"putVisibleElementsToBuffer",value:function(){var e=!1,t=this.visibleElements.slice();this.visibleElements=[];for(var n=0;n<this.boxes.length;n+=1){var r=null;try{r=this.boxes[n].getBoundingClientRect()}catch(t){e=!0,this.boxes[n]=null}r&&(this.isSignificantPartOfElementVisible(r)?(this.visibleElements.push(this.boxes[n]),-1===t.indexOf(this.boxes[n])&&this.boxes[n].dispatchEvent(this.createEvent("inViewport"))):-1!==t.indexOf(this.boxes[n])&&this.boxes[n].dispatchEvent(this.createEvent("outOfViewport")))}e&&(this.boxes=this.boxes.filter((function(e){return null!==e})),ce(this.targetWindow.document).forEach(this.addBox.bind(this)))}},{key:"markElementAsSeen",value:function(e,t){if(e){var n=parseInt(e.getAttribute("data-visible-for"),10)||0;(!e.getAttribute("data-seen")&&n+t)>=this.config.timeoutValue&&(e.setAttribute("data-seen",!0),e.dispatchEvent(this.createEvent("boxView"))),e.setAttribute("data-visible-for",n+t)}}},{key:"markPreviouslyVisibleElementsAsSeen",value:function(){var e=this,t=(new Date).getTime();this.visibleElements.forEach((function(n){e.markElementAsSeen(n,t-e.state.counterStartTime)}))}},{key:"markPreviouslyVisibleElementsAsSeenAfterScroll",value:function(){var e=this;this.visibleElements.forEach((function(t){e.markElementAsSeen(t,e.state.scrollStartTime-e.state.counterStartTime)}))}},{key:"markCurrentlyVisibleElementsAsSeen",value:function(){var e=this;this.visibleElements.forEach((function(t){e.markElementAsSeen(t,e.config.timeoutValue)}))}},{key:"resetCurrentlyVisibleElements",value:function(){this.markPreviouslyVisibleElementsAsSeen(),this.putVisibleElementsToBuffer(),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"resetCurrentlyVisibleElementsAfterScroll",value:function(){this.markPreviouslyVisibleElementsAsSeenAfterScroll(),this.putVisibleElementsToBuffer(),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"scrollHandler",value:function(){this.state.isScrolling||(this.state.scrollStartTime=(new Date).getTime(),this.state.isScrolling=!0),clearTimeout(this.markCurrentlyVisibleElementsAsSeenOnTimeout()),this.scrollEndHandler()}},{key:"resizeHandler",value:function(){this.setUserViewport(),this.resetCurrentlyVisibleElements()}},{key:"addBox",value:function(e){-1===this.boxes.indexOf(e)&&this.boxes.push(e)}},{key:"isBoxInViewport",value:function(e){return-1!==this.visibleElements.indexOf(e)}},{key:"clearAttributes",value:function(e){this.boxes.forEach((function(t){t&&t.matches(e)&&(t.removeAttribute("data-seen"),t.removeAttribute("data-visible-for"))}))}},{key:"markBoxAsRendered",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t&&this.clearAttributes(t),e.getAttribute("data-analytics-enabled")&&this.addBox(e),ce(e).forEach(this.addBox.bind(this)),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"markBoxAsVisible",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addBox(e),t?this.markElementAsSeen(e,this.config.timeoutValue):this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"recursivelyMarkBoxAsVisible",value:function(e){var t=this;this.addBox(e),ce(e).forEach((function(e){t.addBox(e)})),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"removeBox",value:function(e){this.boxes=this.boxes.filter((function(t){return t!==e})),this.visibleElements=this.visibleElements.filter((function(t){return t!==e}))}},{key:"markBoxAsHidden",value:function(e){this.removeBox(e),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"unmountNode",value:function(e){var t=this;se(e).forEach((function(e){return t.removeBox(e)}))}},{key:"recursivelyMarkBoxAsHidden",value:function(e){var t=this;this.removeBox(e),ce(e).forEach((function(e){t.removeBox(e)})),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"trackBoxScroll",value:function(e){e.addEventListener("scroll",this.scrollHandlerWithContext)}},{key:"initialize",value:function(){this.targetWindow.addEventListener("scroll",this.scrollHandlerWithContext),this.targetWindow.addEventListener("resize",this.resizeEndHandler),this.resetCurrentlyVisibleElements()}},{key:"createAPI",value:function(){return{markBoxAsRendered:this.markBoxAsRendered.bind(this),markBoxAsVisible:this.markBoxAsVisible.bind(this),recursivelyMarkBoxAsVisible:this.recursivelyMarkBoxAsVisible.bind(this),markBoxAsHidden:this.markBoxAsHidden.bind(this),recursivelyMarkBoxAsHidden:this.recursivelyMarkBoxAsHidden.bind(this),trackBoxScroll:this.trackBoxScroll.bind(this),isBoxInViewport:this.isBoxInViewport.bind(this)}}}]),e}(),he=function(){function e(t){var r=t.targetWindow,i=t.onCycleComplete;n(this,e),this.window=r,this.document=this.window.document,this.onCycleComplete=i,this.initTimeStamp=null,this.engagementCycleStartTime=null,this.engagementTime=0,this.maxScrollBottom=this.getScrollBottom(),this.previousInteractionTime=null,this.handleInteraction=this.handleInteraction.bind(this),this.refreshEngagementCycle=this.refreshEngagementCycle.bind(this)}return i(e,[{key:"getTimeSpentOnPage",value:function(){return q()-this.initTimeStamp}},{key:"updateEngagementTime",value:function(e){if(this.previousInteractionTime){var t;if(this.previousInteractionTime<this.engagementCycleStartTime){var n=e-this.engagementCycleStartTime,r=2e3-(this.engagementCycleStartTime-this.previousInteractionTime);t=Math.min(n,r)}else{var i=e-this.previousInteractionTime;t=Math.min(i,2e3)}this.engagementTime+=t}}},{key:"updateMaxScrollBottom",value:function(){var e=this.getScrollBottom();e>this.maxScrollBottom&&(this.maxScrollBottom=e)}},{key:"getScrollBottom",value:function(){var e=this.window;return e.innerHeight+(e.scrollY||this.document.documentElement.scrollTop)}},{key:"getPageHeight",value:function(){var e=this.document,t=e.body,n=e.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight)}},{key:"endCycle",value:function(e){this.updateEngagementTime(e),this.engagementTime>0&&this.onCycleComplete({engagementTime:this.getEngagementTimeWithLimit(),scrollBottom:this.maxScrollBottom,pageHeight:this.getPageHeight()});var t=e-2e3;this.previousInteractionTime<t&&(this.previousInteractionTime=null),this.engagementTime=0,this.engagementCycleStartTime=e,this.maxScrollBottom=this.getScrollBottom()}},{key:"getEngagementTimeWithLimit",value:function(){return Math.min(this.engagementTime,6e3)}},{key:"handleInteraction",value:function(){var e=this.getTimeSpentOnPage();this.updateEngagementTime(e),this.updateMaxScrollBottom(),this.previousInteractionTime=e}},{key:"refreshEngagementCycle",value:function(){this.endCycle(this.getTimeSpentOnPage())}},{key:"startEngagementCycles",value:function(){this.engagementCycleStartTime=this.getTimeSpentOnPage(),setInterval(this.refreshEngagementCycle,6e3)}},{key:"initialize",value:function(){this.initTimeStamp=q(),H(this.document,"click",this.handleInteraction),H(this.document,"mousemove",this.handleInteraction),H(this.document,"keydown",this.handleInteraction),H(this.document,"scroll",this.handleInteraction),H(this.window,"beforeunload",this.refreshEngagementCycle),this.startEngagementCycles()}}]),e}(),fe=function(e,t){for(var n,r={},i=0;i<e.attributes.length;i+=1){var o=e.attributes[i];if(0===o.name.indexOf(t)){var a=o.name.replace(t,"");r[(n=a,n.replace(/^([A-Z])|[\s|_-](\w)/g,(function(e,t,n){return n?n.toUpperCase():t.toLowerCase()})))]=o.value}}return r},ve=function(e){var t=e.contextNode,n=e.customParams,r=void 0===n?{}:n,i=fe(t,"data-analytics-view-opbox-custom-"),o=Object.keys(i).length?{_opbox:i}:{};return ae(fe(t,"data-analytics-view-custom-"),o,r)},me=function(e){var t=e.contextNode,n=e.coordinates,r=void 0===n?{}:n,i=e.destinationUrl,o=void 0===i?"":i,a=e.customParams,c=void 0===a?{}:a,u=e.isNewTab,l=u?{isNewTab:u}:{},d=s({},fe(t,"data-analytics-click-opbox-custom-"),{destinationUrl:o},l,{},r);return ae(fe(t,"data-analytics-click-custom-"),{_opbox:d},c)},pe=function(e){var t=e.contextNode,n=e.customParams,r=void 0===n?{}:n,i=fe(t,"data-analytics-interaction-custom-"),o=fe(t,"data-analytics-interaction-opbox-custom-"),a=Object.keys(o).length?{_opbox:o}:{};return ae(i,a,r)},ge=function(e){var t=e.closest("[".concat("data-analytics-tags","]"));if(!t)return[];var n,r,i,o,a=!!t.closest("[".concat("data-item","]"))?function(e){var t=e&&e.closest("[".concat("data-box-name","][").concat("data-analytics-tags","]"));return t&&t.getAttribute("data-analytics-tags")||""}(t):"",s=t.getAttribute("data-analytics-tags")||"";return n=s,r=a.split(","),i=n.split(","),(o=r.concat(i)).filter((function(e,t){return e&&o.indexOf(e)===t}))},ye=function(e){var t=e.closest("[data-analytics-groups]");if(t){var n=decodeURIComponent(t.getAttribute("data-analytics-groups"));try{n=JSON.parse(n)}catch(e){return console.log("JSON.parse error! Can not convert ".concat(n," to JSON.")),[]}return n}return[]};function be(e,t,n){return e.addEventListener(t,n),{remove:function(){e.removeEventListener(t,n)}}}var ke=function(){function e(t){var r=t.targetWindow,i=t.config,o=t.cookieMonsterClient,a=t.boxViewsMarker,s=t.sendPerformanceMetrics;n(this,e);var c=i.cookieMonster,u=(c=void 0===c?{}:c).boxViewDisabled,l=c.isEngagementMeasuringEnabled,d=c.defaultCustomParams,h=void 0===d?{}:d;this.targetWindow=r,this.document=this.targetWindow.document,this.boxViewDisabled=u,this.isEngagementMeasuringEnabled=l,this.cookieMonsterClient=o,this.boxViewsMarker=a,this.defaultCustomParams=h,this.eventCallbacks=[],this.sendPerformanceMetrics=s||V,this.engagementObserver=new he({targetWindow:r,onCycleComplete:this.sendPingEvent.bind(this)});var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.navigator,n=(t=void 0===t?{}:t).userAgent,r=void 0===n?"":n;return r}(r);this.isMobile=function(e){return!!e.match(U)}(f),this.isSafari=function(e){return!!e.match(B)}(f),this.isFirefox=function(e){return e.toLowerCase().includes("firefox")}(f)}return i(e,[{key:"initialize",value:function(){this.cookieMonsterClient.initialize(),this.isEngagementMeasuringEnabled&&this.engagementObserver.initialize(),this.eventHandlers=[be(this.document,"change",this.handleChange.bind(this)),be(this.document,"click",this.handleClick.bind(this)),be(this.document,"mousedown",this.handleLinkClick.bind(this)),be(this.document,"submit",this.handleSubmit.bind(this)),be(this.document,"contextmenu",this.handleClick.bind(this)),be(this.document,"boxView",this.handleBoxView.bind(this)),be(this.targetWindow,"DOMContentLoaded",this.detectAdblock.bind(this))]}},{key:"teardown",value:function(){this.eventHandlers.forEach((function(e){e.remove()}))}},{key:"sendEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.contextNode,n=e.action,r=e.label,i=void 0===r?"":r,o=e.value,a=e.customParams,c=void 0===a?{}:a;if(!t||!n)return{};var u=t.closest("[data-analytics-category]").getAttribute("data-analytics-category"),l=t.closest("[data-box-name]").getAttribute("data-box-name"),d=t.closest("[data-box-id]"),h=d&&d.getAttribute("data-box-id"),f=ge(t),v=ye(t),m=f.length?{analyticsTags:f}:{},p=v.length?{groups:v}:{},g=h?{boxName:l,boxId:h}:{boxName:l},y=s({},m,{},p,{},g),b=ae(s({},c),{_opbox:y},this.defaultCustomParams.ev),k={category:u,action:n,label:i,value:o,customParams:b};return this.cookieMonsterClient.send("event",k),this.eventCallbacks.length&&this.eventCallbacks.forEach((function(e){return e(k)})),k}},{key:"sendPingEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.engagementTime,n=e.scrollBottom,r=e.pageHeight;this.cookieMonsterClient.send("event",{category:"Engagement",label:"ping",customParams:{et:t,sb:n,ph:r}})}},{key:"sendClickEvent",value:function(e){this.sendEvent(s({},e,{action:"click"}))}},{key:"sendContextmenuEvent",value:function(e){this.sendEvent(s({},e,{action:"contextmenu"}))}},{key:"sendBoxInteractionEvent",value:function(e){this.sendEvent(s({},e,{action:"boxInteraction"}))}},{key:"sendItemViewEvent",value:function(e){this.sendEvent(s({},e,{action:"itemView"}))}},{key:"sendBoxViewEvent",value:function(e){this.sendEvent(s({},e,{action:"boxView"}))}},{key:"sendFormSubmitEvent",value:function(e){this.sendEvent(s({},e,{action:"submit"}))}},{key:"detectAdblock",value:function(){var e=this,t=N(this.document,"div",{innerHTML:"&nbsp;",className:"adsbox"});this.document.body.appendChild(t),this.targetWindow.setTimeout((function(){var n=0!==t.offsetHeight;e.cookieMonsterClient.send("event",{category:"clearPV",action:n,customParams:e.defaultCustomParams.ev}),e.document.body.removeChild(t)}),100)}},{key:"handleClick",value:function(e){this.handleBoxInteraction(e),this.handleLinkClick(e)}},{key:"handleBoxInteraction",value:function(e){if("function"==typeof e.target.closest){var t=e.target.closest("[data-analytics-interaction]");if(t){var n=pe({contextNode:t}),r=t.getAttribute("data-analytics-interaction-label")||"",i=t.getAttribute("data-analytics-interaction-value")||t.textContent.trim();this.sendBoxInteractionEvent({contextNode:t,label:r,value:i,customParams:n})}}}},{key:"shouldHandleBoxInteraction",value:function(e){return"mousedown"===e.type&&!this.isMobile&&(this.isSafari||this.isFirefox)&&"select-one"===e.target.type}},{key:"handleLinkClick",value:function(e){if("function"==typeof e.target.closest)if(this.shouldHandleBoxInteraction(e))this.handleBoxInteraction(e);else{var t=e.target.closest("a");if(t&&t.hasAttribute("data-analytics-clickable")){var n=t.getAttribute("data-analytics-click-label")||"",r=t.getAttribute("data-analytics-click-value")||t.textContent.trim(),i="_blank"===t.getAttribute("target"),o=t.getAttribute("href"),a=e.pageX?{pageX:e.pageX,pageY:e.pageY}:{};"click"!==e.type||0!==e.button?"contextmenu"!==e.type?"mousedown"===e.type&&1===e.button&&this.sendClickEvent({contextNode:t,label:n,value:r,customParams:me({contextNode:t,coordinates:a,destinationUrl:o,isNewTab:!0})}):this.sendContextmenuEvent({contextNode:t,label:n,value:r,customParams:me({contextNode:t,coordinates:a,destinationUrl:o})}):this.sendClickEvent({contextNode:t,label:n,value:r,customParams:me({contextNode:t,coordinates:a,destinationUrl:o,isNewTab:i||e.metaKey||e.ctrlKey})})}}}},{key:"handleChange",value:function(e){var t=e.target;if("select-one"===t.type&&t&&t.hasAttribute("data-analytics-selectable")){var n=t.options[t.selectedIndex].value,r=fe(t,"data-analytics-select-custom-");this.sendEvent({contextNode:t,action:"change",value:n,customParams:r})}}},{key:"handleSubmit",value:function(e){var t=e.target;if(t&&"FORM"===t.nodeName&&t.hasAttribute("data-analytics-submittable")){var n=t.getAttribute("action"),r=T(t.elements).filter((function(e){return e.name})).map((function(e){return{name:e.name,value:e.value}})).sort((function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())})).map((function(e){return"".concat(e.name,"=").concat(e.value)})).join("&"),i=(r=r?"?".concat(r):"")?n+r:n;i=encodeURI(i),this.sendFormSubmitEvent({contextNode:t,value:i,label:"submitForm"})}}},{key:"markParentBoxAsVisible",value:function(e){var t=e.parentNode&&e.parentNode.closest("[data-analytics-enabled]");this.boxViewsMarker&&t&&!t.hasAttribute("data-seen")&&this.boxViewsMarker.markBoxAsVisible(t,!0)}},{key:"handleBoxView",value:function(e){var t=e.target;if(t&&t.hasAttribute("data-analytics-enabled")&&(!this.boxViewDisabled||t.hasAttribute("data-item"))&&!T(t.childNodes).some((function(e){return e.classList&&e.classList.contains("opbox-fragment")}))){var n=t.getAttribute("data-analytics-view-value")||"",r=t.getAttribute("data-analytics-view-label")||"",i=ve({contextNode:t});if(t.firstChild&&t.firstChild.nodeType===Node.ELEMENT_NODE&&(i=s({},i,{},fe(t.firstChild,"data-analytics-view-custom-"))),t.hasAttribute("data-item"))return this.markParentBoxAsVisible(t),void this.sendItemViewEvent({contextNode:t,label:r,value:n,customParams:i});i=s({},i,{},function(e){if(!e)return{};var t=e.getAttribute("data-analytics-box-view-custom-params");if(!t)return{};var n={};try{n=JSON.parse(decodeURIComponent(t))}catch(e){console.log(e)}return n}(t)),this.sendBoxViewEvent({contextNode:t,value:n,customParams:i})}}},{key:"sendPageViewProxy",value:function(){this.sendPerformanceMetrics(),this.cookieMonsterClient.sendPageView(this.defaultCustomParams.pv),this.cookieMonsterClient.updateReferrer()}},{key:"sendEventProxy",value:function(e,t,n,r){return e.nodeType===Node.ELEMENT_NODE?this.sendEvent({contextNode:e,action:t,value:n,customParams:r}):this.sendEvent(e)}},{key:"sendItemViewEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams;this.sendItemViewEvent({contextNode:t,label:n,value:r,customParams:ve({contextNode:t,customParams:i})})}},{key:"sendClickEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams,o=e.destinationUrl,a=e.isNewTab;if(a&&"boolean"!=typeof a)throw new Error("isNewTab property must be boolean");this.sendClickEvent({contextNode:t,label:n,value:r,customParams:me({contextNode:t,destinationUrl:o,customParams:i,isNewTab:a})})}},{key:"sendContextmenuEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams,o=e.destinationUrl;this.sendContextmenuEvent({contextNode:t,label:n,value:r,customParams:me({contextNode:t,destinationUrl:o,customParams:i})})}},{key:"sendBoxInteractionEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams;this.sendBoxInteractionEvent({contextNode:t,label:n,value:r,customParams:pe({contextNode:t,customParams:i})})}},{key:"updateCustomParams",value:function(e){var t=e.pv,n=void 0===t?{}:t,r=e.ev,i=void 0===r?{}:r;E(n)&&E(i)?this.defaultCustomParams={pv:n,ev:i}:console.log("Can not update custom params with non-object arguments!")}},{key:"registerEventCallback",value:function(e){e&&!this.eventCallbacks.includes(e)&&this.eventCallbacks.push(e)}},{key:"createAPI",value:function(){return{sendPageView:this.sendPageViewProxy.bind(this),sendEvent:this.sendEventProxy.bind(this),sendItemViewEvent:this.sendItemViewEventProxy.bind(this),sendClickEvent:this.sendClickEventProxy.bind(this),sendContextmenuEvent:this.sendContextmenuEventProxy.bind(this),sendBoxInteractionEvent:this.sendBoxInteractionEventProxy.bind(this),registerEventCallback:this.registerEventCallback.bind(this)}}}]),e}();function we(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e&&S(e[t])&&e[t](n)}var xe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.targetWindow,i=t.services,o=t.reportError,a=t.unmountNodeCallback,s=t.mountNodeCallback;n(this,e),this.targetWindow=r,this.services=i,this.implementations=new Map,this.instances=new Map,this.reportError=o,this.unmountNodeCallback=a,this.mountNodeCallback=s}return i(e,[{key:"unmountNode",value:function(e){var t=this;this.unmountNodeCallback(e),O(e,"[data-prototype-id]").concat([e]).forEach((function(e){var n=e.getAttribute("data-box-id")||e.getAttribute("data-box-name");we(t.instances.get(n),"onUnmount"),t.instances.set(n,null)}))}},{key:"mountNode",value:function(e){var t=this;O(e,"[data-prototype-id]").concat([e]).forEach((function(e){var n=e.getAttribute("data-prototype-id");t.registerInstancesForPrototype(n,[e])})),this.mountNodeCallback(e)}},{key:"isPrototypeObjectValid",value:function(e){var n=e.prototypeName;return"string"!=typeof n?(this.reportError(new Error('Property "prototypeName" must be string but got '.concat(t(n)))),!1):""!==n||(this.reportError(new Error('Property "prototypeName" cannot be empty string')),!1)}},{key:"containsValidPrototypes",value:function(e){var t=this;return 0===e.length?(this.reportError(new Error("Empty handledPrototypes list")),!1):!e.filter((function(e){return!t.isPrototypeObjectValid(e)})).length}},{key:"isPrototypeValid",value:function(e){return C(e)?this.containsValidPrototypes(e):E(e)?this.isPrototypeObjectValid(e):(this.reportError(new Error('"handledPrototype" argument must be an object or an array')),!1)}},{key:"isImplementationValid",value:function(e){return S(e)?e.prototype.onUpdate&&!S(e.prototype.onUpdate)?(this.reportError(new Error('"onUpdate" property must be a function or undefined but got '.concat(t(e.prototype.onUpdate)))),!1):!!S(e.prototype.onMount)||(this.reportError(new Error('"implementation" class has to have "onMount" method')),!1):(this.reportError(new Error('"implementation" must be a class')),!1)}},{key:"registerInstancesForPrototype",value:function(e,t){var n=this.implementations.get(e);n&&this.registerInstances(t,this.services.getServicesForComponent({prototypeName:e}),n)}},{key:"registerImplementationAndInstances",value:function(e,t){this.implementations.has(e)?this.reportError(new Error("".concat(e," already registered!"))):(this.implementations.set(e,t),this.registerInstancesForPrototype(e,O(this.targetWindow.document,'[data-prototype-id="'.concat(e,'"]'))))}},{key:"updateComponentCallback",value:function(e,t){we(this.instances.get(e),"onUpdate",t)}},{key:"beforeUpdateComponentCallback",value:function(){this.instances.forEach((function(e){return we(e,"beforeOnUpdate")}))}},{key:"getSerializedPropsFromNode",value:function(e){if(!e)return{};try{return JSON.parse(e.textContent)}catch(e){return this.reportError(e),{}}}},{key:"getSerializedPropsForBox",value:function(e,t){var n=[e?'[data-serialize-box-id="'.concat(e,'"]'):null,t?'[data-serialize-box-name="'.concat(t,'"]'):null].filter(Boolean).join(", "),r=this.targetWindow.document.querySelector(n);return r?this.getSerializedPropsFromNode(r):{}}},{key:"registerInstances",value:function(e,t,n){var r=this;e.forEach((function(e){var i=e.getAttribute("data-box-name"),o=e.getAttribute("data-box-id"),a=r.getSerializedPropsForBox(o,i),s=new n({baseNode:e,props:a,services:t}),c=o||i;r.instances.set(c,s),s.onMount()}))}},{key:"register",value:function(e,t){var n=this;this.isPrototypeValid(e)&&this.isImplementationValid(t)&&(C(e)?e.forEach((function(e){var r=e.prototypeName;n.registerImplementationAndInstances(r,t)})):this.registerImplementationAndInstances(e.prototypeName,t))}},{key:"createPublicAPI",value:function(){return{register:this.register.bind(this)}}},{key:"createPrivateAPI",value:function(){return{updateComponentCallback:this.updateComponentCallback.bind(this),beforeUpdateComponentCallback:this.beforeUpdateComponentCallback.bind(this),unmountNode:this.unmountNode.bind(this),mountNode:this.mountNode.bind(this)}}}]),e}(),Ee=function(){return Promise.reject(new Error("missing edge host"))},Ce=function(){function e(t){var r=t.httpClient,i=t.config,o=void 0===i?{}:i;n(this,e),this.edgeHost=o.edgeHost,this.httpClient=r,this.defaultRequestSettings={headers:{"Content-type":"application/vnd.allegro.public.v1+json",Accept:"application/vnd.allegro.public.v1+json","Accept-Language":o.language}}}return i(e,[{key:"prepareRequestSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.disableDefaultHeaders)return e;var t=this.normalizeSettings(e);return ae({},this.defaultRequestSettings,t)}},{key:"normalizeSettings",value:function(e){if(!e||!e.headers)return e;var n=function e(n,r){return Object.keys(n).reduce((function(i,o){var a=n[o],s="object"===t(a)?e(a,r):a;return i[r.find((function(e){return o.toLowerCase()===e.toLowerCase()}))||o]=s,i}),{})}(e.headers,Object.keys(this.defaultRequestSettings.headers));return x(e,{headers:n})}},{key:"prepareRequestUrl",value:function(e){return this.edgeHost+e}},{key:"get",value:function(e,t){return this.httpClient.get(this.prepareRequestUrl(e),this.prepareRequestSettings(t))}},{key:"put",value:function(e,t,n){return this.httpClient.put(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n))}},{key:"post",value:function(e,t,n){return this.httpClient.post(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n))}},{key:"patch",value:function(e,t,n){return this.httpClient.patch(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n))}},{key:"delete",value:function(e,t){return this.httpClient.delete(this.prepareRequestUrl(e),this.prepareRequestSettings(t))}},{key:"createAPI",value:function(){return this.edgeHost?{get:this.get.bind(this),put:this.put.bind(this),post:this.post.bind(this),patch:this.patch.bind(this),delete:this.delete.bind(this)}:{get:Ee,put:Ee,post:Ee,patch:Ee,delete:Ee}}}]),e}(),Pe=function(){function e(t){var r=t.targetWindow,i=t.alias,o=void 0===i?"cm":i,a=t.config,s=void 0===a?{}:a,c=t.isExternal,u=void 0!==c&&c;n(this,e);var l=s.cookieMonster,d=l.host,h=l.account,f=l.defaultCustomParams,v=void 0===f?{}:f,m=l.referrer,p=void 0===m?document.referrer:m;this.targetWindow=r,this.document=this.targetWindow.document,this.alias=o,this.host=d,this.account=h,this.isExternal=u,this.defaultCustomParams=v,this.referrer=p}return i(e,[{key:"initialize",value:function(){if(this.isExternal)return this.loadExternal(),void this.callCookieMonster.call(this,"create",this.account);this.host&&this.account&&!this.isLoaded()?(this.load(),this.callCookieMonster.call(this,"create",this.account),this.sendPageView(),this.updateReferrer()):this.updateReferrer()}},{key:"load",value:function(){this.isLoaded()||function(e,t,n,r,i){e["cm.analytics.object"]=i,e[i]=e[i]||function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e[i].q=e[i].q||[]).push(n)};var o=N(t,"script",{src:r}),a=t.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)}(this.targetWindow,this.document,0,this.host,this.alias)}},{key:"loadExternal",value:function(){this.isLoaded()||function(e,t){e["cm.analytics.object"]=t,e[t]=e[t]||function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(e[t].q=e[t].q||[]).push(r)}}(this.targetWindow,this.alias)}},{key:"send",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.callCookieMonster).call.apply(e,[this,this.sendCommand()].concat(n))}},{key:"sendPageView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultCustomParams.pv||{};this.send("pageview",{customParams:e,referrer:this.referrer})}},{key:"updateReferrer",value:function(){this.referrer=window.location.href}},{key:"callCookieMonster",value:function(){if(this.isLoaded()){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.targetWindow[this.alias].apply(null,t)}}},{key:"isLoaded",value:function(){return"function"==typeof this.targetWindow[this.alias]}},{key:"sendCommand",value:function(){return"send@".concat(this.account)}}]),e}(),Se=function(e){return function(t){0===t.status||(e.newrelic?(console.error("Reporting error to newrelic: ".concat(t.message)),e.newrelic.noticeError(t)):console.error("Error: ".concat(t.message)))}},Ae=function(e){var t=e.origin,n=e.pathname,r=e.search;return"".concat(t).concat(n).concat(r)},Te=function(e,t){function n(e){for(var t,n,r,i,o=new RegExp("([^&=]+)=?([^&]*)","g"),a={},s=e.substring(e.indexOf("?")+1,e.length);t=o.exec(s);)n=a,r=decodeURIComponent(t[1]),i=decodeURIComponent("string"===t[1]?t[2].replace(/\+/g," "):t[2]),void 0===n[r]?n[r]=[i]:n[r].push(i);return a}var r,i=n(e),o=function(e,t){for(var n=0,r=e.length;n<r;n+=1)if(t(e[n],n,e))return e[n];return null}(i,function(e){return function(t){return t.name===e}}("route"));function a(e){t.forEach((function(t){return n=e,r=t.name,i=t.value,void(n[r]=Array.isArray(i)?i:[i]);var n,r,i}))}function s(e){return Object.keys(e).map((function(t){return e[t].map((function(e){return[t,e]}))})).reduce(W,[]).reduce((function(e,t){var n=p(t,2),r=n[0],i=n[1];return null!=i?"".concat(e).concat((e?"&":"?")+encodeURIComponent(r),"=").concat(encodeURIComponent(i)):e}),"")}return o&&0===o.value.indexOf("http")?(a(r=2===o.value.split("?").length?n(o.value.split("?")[1]):[]),o.value=o.value.split("?")[0]+s(r)):a(i),s(i)},Oe=function(){function e(t){var r=t.targetWindow,i=t.opboxWebClient,o=t.rawDataListenersRegistry;n(this,e),this.targetWindow=r,this.opboxWebClient=i,this.rawDataListenersRegistry=o,this.history=[r.location.pathname],this.recentlyFetchedURL=Ae(r.location)}return i(e,[{key:"initialize",value:function(){var e=this;this.targetWindow.onpopstate=function(t){return e.handlePopState(t)},this.targetWindow.history.replaceState({opboxjs:!0},"")}},{key:"isInternalNavigation",value:function(e){return this.history.find((function(t){return t===e}))}},{key:"navigateRelative",value:function(e){var t=this.targetWindow.location,n=t.pathname,r=t.search,i=n+r,o=n+Te(r,e);return this.changeUrl(o),this.history.push(n),this.targetWindow.performance.mark("clientSideNavigationStart"),o!==i&&this.fetch(o),o}},{key:"refreshPage",value:function(){var e=this.targetWindow.location,t=e.pathname+e.search;this.fetch(t)}},{key:"changeUrl",value:function(e){return this.targetWindow.history.pushState("","",e)}},{key:"handlePopState",value:function(e){var t=e.target.location.pathname,n=Ae(e.target.location);this.isInternalNavigation(t)&&this.recentlyFetchedURL!==n&&this.refreshPage()}},{key:"fetch",value:function(e){var t=this;this.recentlyFetchedURL=Ae(this.targetWindow.location),this.rawDataListenersRegistry.triggerProgressListener(),this.opboxWebClient.getPageData(e).then((function(e){return t.rawDataListenersRegistry.triggerChangeListener(e)})).catch(Se)}}]),e}(),Ne="opboxAnimationTimerInterval",Re=function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},Ie=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}};function Me(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=i.duration,a=void 0===o?500:o,s=i.onFinish;if("function"!=typeof r)return null;var c=Ie(e),u=Date.now(),l=n-t,d=!1,h=function(){d=!0},f=function e(){var n=Date.now()-u;if(d||n>=a)"function"==typeof s&&s(),d=!1;else{var i=Math.min(n/a,1),o=Re(i)*l+t;r(o),c(e)}};return f(),{stop:h}}function Ve(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.duration,i=void 0===r?500:r,o=e.pageYOffset,a=Math.max(0,t),s=e.document.body.scrollHeight;function c(t){var n=t===a||t===a,r=e.innerHeight+t>=s;return n||r}function u(){e[Ne]&&"function"==typeof e[Ne].stop&&(e[Ne].stop(),e[Ne]=null)}var l=function(t){e.scrollTo(0,Math.round(t)),c(t)&&u()};u(),e[Ne]=Me(e,o,t,l,{duration:i})}function je(e,t){return function(n){if(!e.has(n))return Promise.reject(new Error("Service ".concat(n," is not registered")));var r=e.get(n);return r.fetchIfNotFetched(t),r.promise}}var We=function(){function e(t){var r=this,i=t.prototypeName,o=t.servicesRegistry,a=t.targetWindow;n(this,e),this.services=new Map,this.targetWindow=a,o.forEach((function(e,t){e.components.some((function(e){return e.prototypeName===i}))&&r.services.set(t,e)})),this.get=je(this.services,this.targetWindow)}return i(e,[{key:"has",value:function(e){return this.services.has(e)}}]),e}();function Le(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.inHead,i=void 0!==r&&r,o=n.referenceNode,a=void 0===o?null:o;return function(n){if(A(n))return null;var r=N(e.document,"link",n,{rel:t});if(a)R(a,r);else{var o=i?"head":"body";e.document[o].appendChild(r)}return r}}var Be,Ue=["spinner","button","link","badge","brand","card","chart","desk","divider","heading","hint","icon","indicator","input","list","marker","notification","placeholder","price","progress","table","dropdown","breadcrumb","accordion","attachment","carousel","chip","choice","dialog","field","image-tile","input-group","message","modal","pagination","range","select","slider","soap","stepper","tabs","typography","color","grid","align","border","box-sizing","display","flex","height","margin","padding","position","utils","visibility","white-space","width","zindex","calendar","navigation-tiles","pin","player-video","sheet"],De=function(e,t,n){var r=Le(e,"stylesheet",{inHead:!0,referenceNode:n})({type:"text/css",href:t});return new Promise((function(e,t){r.addEventListener("error",t),r.addEventListener("load",e)}))},He=function(e){return function(t){return-1!==t.href.indexOf(e)}};function qe(e){var t=function(e){return T(e.document.styleSheets).find((function(e){var t=e.href;return t&&t.includes("/metrum-bundle/")}))}(e),n=!!t,r=[];return{isMetrumBundleEnabled:n,inject:function(i){if(!n)return Promise.resolve();var o=function(e,t){return t.reduce((function(t,n){var r=p(t,2),i=r[0],o=r[1];return e.includes(n)||o.push(n),i.push(n),[i,o]}),[[],[]])}(r,i),a=p(o,2),s=a[0],c=a[1];return r=s,c.length?function(e,t){var n=N(e,"iframe",{style:"display:none"}),r=function(){return e.body.removeChild(n)};e.body.appendChild(n);var i=n.contentDocument,o=n.contentWindow;return i.open("text/html","replace"),i.write(t.map(_).join("")),i.close(),new Promise((function(e){o.addEventListener("load",(function t(){o.removeEventListener("load",t),e([T(i.styleSheets),r])}))}))}(e.document,c).then((function(e){var n=p(e,2),r=n[0],i=n[1];r.forEach((function(e){if(!function(e,t){return t.rules.length>0&&T(e.rules).findIndex((function(e){return e.cssText===t.rules[0].cssText}))>-1}(t,e))for(var n=M(e.href),r=function(e,t){return T(e.rules).findIndex((function(e){return e.selectorText==="._".concat(t,"_e_")}))}(t,n),i=r>0?r:t.rules.length,o=T(e.rules),a=0;a<o.length;a+=1)t.insertRule(o[a].cssText,i+a)})),i()})):Promise.resolve()}}}function _e(e,t,n,r){var i=M(n);return r.includes(i)?De(e,n,function(e,t,n){var r=e.filter((function(e){return e.isMetrum})),i=t.slice(0,t.indexOf(n)).reverse().find((function(e){return r.find(He(e))})),o=i?r.find(He(i)).node:null;return!o&&r.length?r[0].node.previousElementSibling:!o&&e.length?e[0].node.previousElementSibling:o}(t,r,i)):Promise.resolve()}function ze(e,t,n){var r=n.url,i=n.code;return I(r)?_e(e,t,r,Ue):r?De(e,r):i?function(e,t){var n=N(e.document,"style",{innerHTML:t});return e.document.head.appendChild(n),Promise.resolve()}(e,i):Promise.reject()}function Fe(e,t){return t.filter((function(t){return!e.find((n=t,function(e){return n.url?n.url===e.url||n.url===e.href||n.url===e.src:!!n.code&&n.code===e.code}));var n}))}function Je(e,t){var n=function(e){return O(e,'link[type="text/css"],style',(function(e){return{href:e.href,code:e.innerHTML,node:e,isMetrum:I(e.href)}})).filter((function(e){var t=e.href,n=e.code;return t||n}))}(e.document),r=Fe(n,t),i=Be=Be&&!Be.forceRefresh?Be:qe(e),o=i.inject,a=i.isMetrumBundleEnabled,s=r.reduce((function(t,r){return I(r.url)&&a?(t.metrumStyles.push(r.url),t):(t.injectedStyles.push(ze(e,n,r)),t)}),{metrumStyles:[],injectedStyles:[]}),c=s.metrumStyles,u=s.injectedStyles;return u.push(o(c)),Promise.all(u)}function Xe(e,t){var n=function(e){return T(e.document.getElementsByTagName("script"),(function(e){return{src:e.src,code:e.innerHTML,nonce:e.nonce}}))}(e),r=function(e){return(e.find((function(e){return!!e.nonce}))||{}).nonce}(n),i=Fe(n,t);return Promise.all(i.map(function(e,t){var n=Se(e),r=function(e){return"noModule"in e.document.createElement("script")}(e);return function(i){var o=i.url,a=i.code,s=i.attributes,c=i.type,u=i.async;return o||a?new Promise((function(i){var l,d=!o&&!!a,h="module"===c,f=N(e.document,"script"),v=function e(t){i(),t.message||(t.message="Error while loading script: ".concat(o)),n(t),f.removeEventListener("error",e)};if(!h||r){if(s){if(s.nomodule&&r)return void i();Object.entries(s).forEach((function(t){var n=p(t,2),r=n[0],i=n[1];"data-serialize-box-id"!==r&&"data-serialize-box-name"!==r||(l=e.document.querySelector("[".concat(r,'="').concat(i,'"]'))),f.setAttribute(r,i)}))}t&&f.setAttribute("nonce",t),u&&f.setAttribute("async","async"),c&&(f.type=c),d?(f.innerHTML=a,i()):(f.src=o,f.addEventListener("load",(function e(){i(),f.removeEventListener("error",v),f.removeEventListener("load",e)})),f.addEventListener("error",v)),l?l.parentNode.replaceChild(f,l):e.document.body.appendChild(f)}else i()})):Promise.resolve()}}(e,r)))}function Ye(e,t){var n=t.svgColorMatrixFilters,r=void 0===n?"":n,i=t.assets,o=i.scripts,a=void 0===o?[]:o,s=i.styles,c=void 0===s?[]:s,u=i.prefetches,l=void 0===u?[]:u,d=i.preloads,h=void 0===d?[]:d;return function(e,t){var n=e.document;if(t){var r=n.querySelector("#svg-color-matrix-filters"),i=N(n,"div",{innerHTML:t}).querySelector("svg");r?O(i,"filter",(function(e){r.querySelector("#".concat(e.getAttribute("id")))||r.appendChild(e)})):n.body.insertBefore(i,n.body.firstChild)}}(e,r),function(e,t){t.forEach(Le(e,"preload"))}(e,h),function(e,t){t.forEach(Le(e,"prefetch"))}(e,l),Promise.all([Xe(e,a),Je(e,c)])}var Ge=function(){function e(t){var r=this,i=t.assetUrl,o=t.components,a=t.reportError;n(this,e),this.assetUrl=i,this.components=o,this.reportError=a,this.implementation=null,this.status=0,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))}return i(e,[{key:"registerImplementation",value:function(e){try{this.implementation=new e,this.status=2,this.resolve(this.implementation)}catch(e){this.handleError(e)}}},{key:"fetchIfNotFetched",value:function(e){var t=this;0===this.status&&(this.status=1,Xe(e,[{url:this.assetUrl}]).catch((function(e){t.handleError(e)})))}},{key:"handleError",value:function(e){this.reportError(e),this.status=2,this.reject()}}]),e}(),Ke=function(){function e(t){var r=this,i=t.targetWindow,o=t.reportError;n(this,e),this.targetWindow=i,this.servicesRegistry=new Map;var a=this.targetWindow.document.querySelector('[data-config="services"]');if(a)try{JSON.parse(a.textContent).forEach((function(e){var t=p(e,2),n=t[0],i=t[1],a=i.assetUrl,s=i.components,c=new Ge({assetUrl:a,components:s,reportError:o});r.servicesRegistry.set(n,c)}))}catch(e){o(e)}this.dangerouslyGet=je(this.servicesRegistry,this.targetWindow)}return i(e,[{key:"getServicesForComponent",value:function(e){var t=e.prototypeName;return new We({prototypeName:t,servicesRegistry:this.servicesRegistry,targetWindow:this.targetWindow})}},{key:"register",value:function(e,t){var n=e.serviceName;this.servicesRegistry.get(n).registerImplementation(t)}},{key:"createAPI",value:function(){return{register:this.register.bind(this),__dangerouslyGet__:this.dangerouslyGet.bind(this)}}}]),e}();function $e(e,n){e.forEach((function(e){var r=e.args,i=e.reject,o=e.resolve,a=function(e,n){try{return e.apply(void 0,g(n))}catch(e){return console.error(e),void("object"===t("NREUM")&&null!==NREUM&&"function"==typeof NREUM.noticeError&&NREUM.noticeError(e))}}(n,r);a&&S(a.then)&&S(o)&&S(i)&&a.then(o,i)}))}var Qe=function(){return Date.now()};var Ze=function(){function e(t){var r=t.localStorage,i=t.reportError,o=t.ttlMs,a=void 0===o?2592e6:o,s=t.key,c=void 0===s?"opbox.preferences":s,u=t.timeProvider,l=void 0===u?Qe:u;n(this,e),this.writeToStorage=this.writeToStorage.bind(this),this.loadPreferences=this.loadPreferences.bind(this),this.cleanupPreferences=this.cleanupPreferences.bind(this),this.savePreferences=this.savePreferences.bind(this),this.storage=function(e){try{var t="test_preferences_storage";return e.setItem(t,t),e.getItem(t),e.removeItem(t),!0}catch(e){return!1}}(r)?r:{setItem:function(){},getItem:function(){return{}}},this.ttlMs=a,this.key=c,this.timeProvider=l,this.reportError=i}return i(e,[{key:"savePreferences",value:function(e){var t=this.loadPreferences(),n=this.timeProvider(),r=e.reduce(D((function(e){return o({},e.name,{value:e.value,timestamp:n})})),t);this.writeToStorage(r)}},{key:"writeToStorage",value:function(e){try{this.storage.setItem(this.key,JSON.stringify(e))}catch(e){this.reportError(e)}}},{key:"loadPreferences",value:function(){try{return JSON.parse(this.storage.getItem(this.key))||{}}catch(e){return this.reportError(e),{}}}},{key:"cleanupPreferences",value:function(){var e=this,t=this.loadPreferences(),n=this.timeProvider(),r=Object.entries(t).reduce(D((function(t){var r=p(t,2),i=r[0],a=r[1];return a.timestamp+e.ttlMs>n?o({},i,a):{}})),{});this.writeToStorage(r)}}]),e}(),et={withCredentials:!0,headers:{"Content-type":"application/vnd.allegro.internal.v1+json",Accept:"application/vnd.allegro.internal.v1+json"}},tt=function(){function e(t){var r=t.edgeClient,i=t.localStorage,o=t.ttlMs,a=t.reportError;n(this,e),this.edgeClient=r,this.storage=new Ze({localStorage:i,ttlMs:o,reportError:a}),this.setPreference=this.setPreference.bind(this),this.getPreference=this.getPreference.bind(this),this.getPreferences=this.getPreferences.bind(this),this.getPreferencesFromLocalStorageOrDefaults=this.getPreferencesFromLocalStorageOrDefaults.bind(this)}return i(e,[{key:"setPreference",value:function(e,t){var n={name:e,value:t};return this.storage.savePreferences([n]),this.edgeClient.post("/preferences",n,et)}},{key:"getPreference",value:function(e,t){return"string"==typeof e||e instanceof String?this.getPreferences(o({},e,t)).then((function(t){return t[e]})):Promise.reject(Error("illegal argument type provided as preference name"))}},{key:"getPreferences",value:function(e){var n=this;if("object"!==t(e))return Promise.reject(Error("illegal argument type provided as preferences"));var r=Object.keys(e).join(","),i="".concat("/preferences","?name=").concat(r);return this.edgeClient.get(i,et).then((function(e){return n.storage.savePreferences(e.data.preferences),e.data.preferences.reduce(D((function(e){return o({},e.name,e.value)})),{})})).catch((function(){return n.getPreferencesFromLocalStorageOrDefaults(e)}))}},{key:"getPreferencesFromLocalStorageOrDefaults",value:function(e){this.storage.cleanupPreferences();var t=this.storage.loadPreferences();return Object.entries(e).reduce(D((function(e){var n=p(e,2),r=n[0],i=n[1];return o({},r,r in t?t[r].value:i)})),{})}},{key:"createAPI",value:function(){return{set:this.setPreference,get:this.getPreference,getMany:this.getPreferences}}}]),e}();function nt(e,t){var n=e.navigator.serviceWorker,r=e.location.href;n&&(function(e,t,n){"function"==typeof e.addEventListener&&e.addEventListener("message",(function(e){"installed"===e.data&&t("event","PWA","serviceworker-registered",null,n)}))}(n,t,r),function(e,t){if("function"!=typeof e.getRegistrations)return Promise.resolve();var n=function(e){return e.unregister().then((function(t){return t?e.active.scriptURL:""}))};e.getRegistrations().then((function(e){return Promise.all(e.map(n))})).then((function(e){var n=e.filter(Boolean);n.length>0&&t("event","PWA","serviceworker-unregistered",null,n.join(","))}))}(n,t))}var rt=function(e){var t=e.targetWindow,n=e.unmountNodeCallback,r=e.mountNodeCallback,i=e.injectAssets,o=void 0===i?Ye:i;function a(e){return t.document.querySelector('[data-box-id="'.concat(e,'"]'))}return function(e){var i=e.boxId,s=e.data,c=s.htmlString;return c?o(t,s).then((function(){var e=N(t.document,"div",{innerHTML:c}),o=a(i);n(o),o.parentNode.replaceChild(e.firstElementChild,o),r(a(i))})):Promise.resolve()}},it=new(function(){function e(t,r,i){n(this,e),this.targetWindow=t;var o=function(e){return z(e).config}(this.targetWindow),a=new J({targetWindow:t}),c=new Pe({targetWindow:t,config:o}),u=new de({targetWindow:t}),l=new ke({targetWindow:t,config:o,cookieMonsterClient:c,boxViewsMarker:u,sendPerformanceMetrics:this.sendPerformanceMetrics.bind(this)}),d=Se(t),h=new Ke({targetWindow:t,reportError:d}),f=function(e){var t,n=new xe(e);return{public:s({init:(t=e.targetWindow,function(e,n){var r=e.prototypeName;r&&n({domNodes:O(t.document,'[data-prototype-id="'.concat(r,'"]'))})})},n.createPublicAPI()),private:n.createPrivateAPI()}}({targetWindow:t,services:h,reportError:d,unmountNodeCallback:u.unmountNode.bind(u),mountNodeCallback:u.markBoxAsRendered.bind(u)}),v=new oe({appContext:a,analytics:l,updateComponentCallback:f.private.updateComponentCallback,beforeUpdateComponentCallback:f.private.beforeUpdateComponentCallback}),m=new re({httpClient:r,reportError:d,subtreeRenderCallback:rt({targetWindow:t,unmountNodeCallback:f.private.unmountNode,mountNodeCallback:f.private.mountNode})});this.config=o,this.cookieMonsterClient=c,this.boxViewsMarker=u,this.analytics=l,this.services=h,this.componentAPI=f,this.rawDataListenersRegistry=v,this.opboxWebClient=m,this.reportError=d,this.navigation=new Oe({targetWindow:t,opboxWebClient:m,rawDataListenersRegistry:v}),this.edgeClient=new Ce({httpClient:i,config:o}),this.preferencesClient=new tt({edgeClient:this.edgeClient,localStorage:this.targetWindow.localStorage,reportError:this.reportError}),this.uiTools=function(e){var t=function(t){return"string"!=typeof t?null:e.document.querySelector('a[name="'.concat(t,'"]'))},n=function(t){var n=e.pageYOffset||e.document.documentElement.scrollTop||0;return t?t.getBoundingClientRect().top+n:null};return{getBoxAnchorNode:t,getTopOffset:n,scrollTo:function(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.animate,a=void 0===o||o,s={duration:a?500:0};if("number"!=typeof r){var c=t(r);if(c){var u=n(c);Ve(e,u,s)}}else Ve(e,r,s)},tween:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];Me.apply(void 0,[e].concat(n))}}}(t),this.analytics.initialize(),this.navigation.initialize(),this.boxViewsMarker.initialize()}return i(e,[{key:"domReadyHelper",value:function(e){"loading"===this.targetWindow.document.readyState?this.targetWindow.document.addEventListener("DOMContentLoaded",e):this.targetWindow.setTimeout(e,0)}},{key:"broadcastAPILoadEvent",value:function(){var e=function(e,t){var n=t.document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,{}),n}("opboxAPILoaded",this.targetWindow);this.targetWindow.dispatchEvent(e)}},{key:"attach",value:function(){var e,t,n,r=this,i=z(this.targetWindow),o=this.API;i&&(!function e(t,n,r){for(var i=arguments.length,o=new Array(i>3?i-3:0),a=3;a<i;a++)o[a-3]=arguments[a];if(S(t)&&S(n)){if(!t.__queue__)return;$e(t.__queue__,n),r.apply(void 0,[n].concat(o))}else E(t)&&E(n)&&Object.keys(t).forEach((function(i){e.apply(void 0,[t[i],n[i],r].concat(g(o.concat(i))))}))}(i,o,(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return F(r.targetWindow,L.apply(void 0,[i,e].concat(n)))})),e=i,n=o,t=Object.keys(n).concat("initialized","config"),Object.keys(e).forEach((function(n){t.includes(n)||delete e[n]})),Object.freeze(i)),nt(this.targetWindow,this.cookieMonsterClient.send.bind(this.cookieMonsterClient)),this.broadcastAPILoadEvent(),o.performance.markTimeToInteractive("opbox-web-browser")}},{key:"sendPerformanceMetrics",value:function(){this.targetWindow.pinter&&this.targetWindow.pinter.sendUserTimings&&this.targetWindow.pinter.sendUserTimings()}},{key:"run",value:function(){this.attach()}},{key:"API",get:function(){return{analytics:this.analytics.createAPI(),boxViewsMarker:this.boxViewsMarker.createAPI(),component:this.componentAPI.public,onData:this.rawDataListenersRegistry.registerListener.bind(this.rawDataListenersRegistry),changeParams:this.navigation.navigateRelative.bind(this.navigation),refreshPage:this.navigation.refreshPage.bind(this.navigation),tween:this.uiTools.tween,scrollTo:this.uiTools.scrollTo,page:this.opboxWebClient.createAPI(),edge:this.edgeClient.createAPI(),preferences:this.preferencesClient.createAPI(),onDomReady:this.domReadyHelper.bind(this),loaded:!0,performance:z(this.targetWindow).performance,services:this.services.createAPI(),reportError:this.reportError}}}]),e}())(window,w(),w());it.run();var ot=it.attach.bind(it);return e.attach=ot,e}({});